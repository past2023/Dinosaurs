<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinosaurs and Soldiers - Mission 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            overflow: hidden;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #gameContainer {
            position: relative;
            width: 1280px;
            height: 720px;
            background: #222;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        canvas {
            display: block;
            background: #87CEEB;
        }

        .menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .menu.hidden {
            display: none;
        }

        .menu h1 {
            color: #FFD700;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #8B4513;
        }

        .menu h2 {
            color: #FFF;
            font-size: 32px;
            margin-bottom: 30px;
        }

        .menu-button {
            background: linear-gradient(180deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: 3px solid #1B5E20;
            padding: 15px 40px;
            font-size: 24px;
            margin: 10px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
            min-width: 300px;
        }

        .menu-button:hover {
            background: linear-gradient(180deg, #66BB6A 0%, #43A047 100%);
            transform: scale(1.05);
        }

        .menu-button.selected {
            background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%);
            border-color: #FF8C00;
            color: #000;
        }

        .character-select {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }

        .character-card {
            background: rgba(255,255,255,0.1);
            border: 3px solid #666;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            color: white;
        }

        .character-card:hover {
            border-color: #FFD700;
            transform: scale(1.05);
        }

        .character-card.selected {
            border-color: #FFD700;
            background: rgba(255,215,0,0.2);
        }

        .character-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .character-stats {
            text-align: left;
            font-size: 14px;
            margin-top: 10px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            color: white;
            font-size: 18px;
            margin: 20px 0;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #666;
        }

        .control-key {
            background: #4CAF50;
            padding: 5px 15px;
            border-radius: 3px;
            font-weight: bold;
        }

        .language-select {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .lang-button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid #666;
            padding: 10px 25px;
            font-size: 18px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        .lang-button.selected {
            border-color: #FFD700;
            background: rgba(255,215,0,0.2);
        }

        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 18px;
            z-index: 5;
            text-shadow: 2px 2px 0 #000;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border: 5px solid #FFD700;
            text-align: center;
            z-index: 15;
        }

        .game-over.hidden {
            display: none;
        }

        .game-over h2 {
            color: #FFD700;
            font-size: 48px;
            margin-bottom: 20px;
        }

        .game-over p {
            color: white;
            font-size: 24px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="1280" height="720"></canvas>
        
        <div class="hud" id="hud">
            <div id="healthBar">Health: <span id="health">100</span></div>
            <div id="ammoBar">Ammo: <span id="ammo">999</span></div>
            <div id="scoreBar">Score: <span id="score">0</span></div>
            <div id="missionProgress">Mission Progress: <span id="progress">0</span>%</div>
        </div>

        <!-- Main Menu -->
        <div class="menu" id="mainMenu">
            <h1>DINOSAURS AND SOLDIERS</h1>
            <h2 data-lang="mission1">Mission 1: Prehistoric Assault</h2>
            <button class="menu-button" onclick="showCharacterSelect()" data-lang="start">START GAME</button>
            <button class="menu-button" onclick="showControls()" data-lang="controls">CONTROLS</button>
            <button class="menu-button" onclick="showLanguage()" data-lang="language">LANGUAGE</button>
        </div>

        <!-- Character Selection -->
        <div class="menu hidden" id="characterMenu">
            <h2 data-lang="selectChar">SELECT YOUR CHARACTER</h2>
            <div class="character-select">
                <div class="character-card" onclick="selectCharacter('nova')">
                    <div class="character-name">NOVA</div>
                    <div style="font-size: 60px; margin: 20px 0;">üöÄ</div>
                    <div class="character-stats">
                        <div data-lang="speed">Speed: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        <div data-lang="power">Power: ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</div>
                        <div data-lang="health">Health: ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</div>
                        <div data-lang="special">Special: Rapid Fire</div>
                    </div>
                </div>
                <div class="character-card" onclick="selectCharacter('rex')">
                    <div class="character-name">REX</div>
                    <div style="font-size: 60px; margin: 20px 0;">ü¶ñ</div>
                    <div class="character-stats">
                        <div data-lang="speed">Speed: ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</div>
                        <div data-lang="power">Power: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div data-lang="health">Health: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div data-lang="special">Special: Heavy Damage</div>
                    </div>
                </div>
                <div class="character-card" onclick="selectCharacter('talon')">
                    <div class="character-name">TALON</div>
                    <div style="font-size: 60px; margin: 20px 0;">ü¶Ö</div>
                    <div class="character-stats">
                        <div data-lang="speed">Speed: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div data-lang="power">Power: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        <div data-lang="health">Health: ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</div>
                        <div data-lang="special">Special: Double Jump</div>
                    </div>
                </div>
            </div>
            <button class="menu-button" onclick="showMainMenu()" data-lang="back">BACK</button>
        </div>

        <!-- Controls Menu -->
        <div class="menu hidden" id="controlsMenu">
            <h2 data-lang="controls">CONTROLS</h2>
            <div class="controls-grid">
                <div class="control-item">
                    <span data-lang="moveLeft">Move Left</span>
                    <span class="control-key">A / ‚Üê</span>
                </div>
                <div class="control-item">
                    <span data-lang="moveRight">Move Right</span>
                    <span class="control-key">D / ‚Üí</span>
                </div>
                <div class="control-item">
                    <span data-lang="jump">Jump</span>
                    <span class="control-key">W / ‚Üë / SPACE</span>
                </div>
                <div class="control-item">
                    <span data-lang="crouch">Crouch</span>
                    <span class="control-key">S / ‚Üì</span>
                </div>
                <div class="control-item">
                    <span data-lang="shoot">Shoot</span>
                    <span class="control-key">J / Z</span>
                </div>
                <div class="control-item">
                    <span data-lang="grenade">Grenade</span>
                    <span class="control-key">K / X</span>
                </div>
                <div class="control-item">
                    <span data-lang="chargedLaser">Charged Laser</span>
                    <span class="control-key">Hold J/Z 1s+</span>
                </div>
                <div class="control-item">
                    <span data-lang="vehicle">Enter/Exit Vehicle</span>
                    <span class="control-key">E</span>
                </div>
            </div>
            <button class="menu-button" onclick="showMainMenu()" data-lang="back">BACK</button>
        </div>

        <!-- Language Menu -->
        <div class="menu hidden" id="languageMenu">
            <h2 data-lang="selectLang">SELECT LANGUAGE</h2>
            <div class="language-select">
                <button class="lang-button selected" onclick="setLanguage('en')">English</button>
                <button class="lang-button" onclick="setLanguage('es')">Espa√±ol</button>
                <button class="lang-button" onclick="setLanguage('fr')">Fran√ßais</button>
                <button class="lang-button" onclick="setLanguage('de')">Deutsch</button>
            </div>
            <button class="menu-button" onclick="showMainMenu()" data-lang="back">BACK</button>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over hidden" id="gameOver">
            <h2 id="gameOverTitle">MISSION COMPLETE!</h2>
            <p id="finalScore">Final Score: 0</p>
            <p id="enemiesKilled">Enemies Defeated: 0</p>
            <button class="menu-button" onclick="restartGame()" data-lang="restart">RESTART</button>
            <button class="menu-button" onclick="showMainMenu()" data-lang="mainMenu">MAIN MENU</button>
        </div>
    </div>

    <script>
        // Language System
        const translations = {
            en: {
                mission1: "Mission 1: Prehistoric Assault",
                start: "START GAME",
                controls: "CONTROLS",
                language: "LANGUAGE",
                selectChar: "SELECT YOUR CHARACTER",
                speed: "Speed:",
                power: "Power:",
                health: "Health:",
                special: "Special:",
                back: "BACK",
                moveLeft: "Move Left",
                moveRight: "Move Right",
                jump: "Jump",
                crouch: "Crouch",
                shoot: "Shoot",
                grenade: "Grenade",
                selectLang: "SELECT LANGUAGE",
                restart: "RESTART",
                mainMenu: "MAIN MENU",
                chargedLaser: "Charged Laser",
                vehicle: "Enter/Exit Vehicle"
            },
            es: {
                mission1: "Misi√≥n 1: Asalto Prehist√≥rico",
                start: "INICIAR JUEGO",
                controls: "CONTROLES",
                language: "IDIOMA",
                selectChar: "SELECCIONA TU PERSONAJE",
                speed: "Velocidad:",
                power: "Poder:",
                health: "Salud:",
                special: "Especial:",
                back: "VOLVER",
                moveLeft: "Mover Izquierda",
                moveRight: "Mover Derecha",
                jump: "Saltar",
                crouch: "Agacharse",
                shoot: "Disparar",
                grenade: "Granada",
                selectLang: "SELECCIONAR IDIOMA",
                restart: "REINICIAR",
                mainMenu: "MEN√ö PRINCIPAL",
                chargedLaser: "L√°ser Cargado",
                vehicle: "Entrar/Salir Veh√≠culo"
            },
            fr: {
                mission1: "Mission 1: Assaut Pr√©historique",
                start: "D√âMARRER",
                controls: "CONTR√îLES",
                language: "LANGUE",
                selectChar: "CHOISISSEZ VOTRE PERSONNAGE",
                speed: "Vitesse:",
                power: "Puissance:",
                health: "Sant√©:",
                special: "Sp√©cial:",
                back: "RETOUR",
                moveLeft: "Gauche",
                moveRight: "Droite",
                jump: "Sauter",
                crouch: "S'accroupir",
                shoot: "Tirer",
                grenade: "Grenade",
                selectLang: "S√âLECTIONNER LA LANGUE",
                restart: "RECOMMENCER",
                mainMenu: "MENU PRINCIPAL",
                chargedLaser: "Laser Charg√©",
                vehicle: "Entrer/Sortir V√©hicule"
            },
            de: {
                mission1: "Mission 1: Pr√§historischer Angriff",
                start: "SPIEL STARTEN",
                controls: "STEUERUNG",
                language: "SPRACHE",
                selectChar: "W√ÑHLE DEINEN CHARAKTER",
                speed: "Geschwindigkeit:",
                power: "Kraft:",
                health: "Gesundheit:",
                special: "Spezial:",
                back: "ZUR√úCK",
                moveLeft: "Links",
                moveRight: "Rechts",
                jump: "Springen",
                crouch: "Ducken",
                shoot: "Schie√üen",
                grenade: "Granate",
                selectLang: "SPRACHE W√ÑHLEN",
                restart: "NEUSTART",
                mainMenu: "HAUPTMEN√ú",
                chargedLaser: "Geladener Laser",
                vehicle: "Fahrzeug Einsteigen/Aussteigen"
            }
        };

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-button').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-lang]').forEach(elem => {
                const key = elem.getAttribute('data-lang');
                if (translations[currentLang] && translations[currentLang][key]) {
                    elem.textContent = translations[currentLang][key];
                }
            });
        }

        // Menu System
        function showMainMenu() {
            document.querySelectorAll('.menu').forEach(m => m.classList.add('hidden'));
            document.getElementById('mainMenu').classList.remove('hidden');
            game.state = 'menu';
        }

        function showCharacterSelect() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('characterMenu').classList.remove('hidden');
        }

        function showControls() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('controlsMenu').classList.remove('hidden');
        }

        function showLanguage() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('languageMenu').classList.remove('hidden');
        }

        function selectCharacter(char) {
            document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.character-card').classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('characterMenu').classList.add('hidden');
                startGame(char);
            }, 300);
        }

        function restartGame() {
            document.getElementById('gameOver').classList.add('hidden');
            const char = game.player.type;
            startGame(char);
        }

        // Game Setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Character Stats
        const characters = {
            nova: {
                name: 'Nova',
                speed: 6,
                jumpPower: 15,
                health: 100,
                fireRate: 150,
                damage: 15,
                special: 'rapidFire'
            },
            rex: {
                name: 'Rex',
                speed: 4,
                jumpPower: 12,
                health: 150,
                fireRate: 300,
                damage: 30,
                special: 'heavyDamage'
            },
            talon: {
                name: 'Talon',
                speed: 7,
                jumpPower: 18,
                health: 80,
                fireRate: 200,
                damage: 20,
                special: 'doubleJump'
            }
        };

        // Game State
        const game = {
            state: 'menu',
            player: null,
            enemies: [],
            bullets: [],
            lasers: [],
            grenades: [],
            particles: [],
            explosions: [],
            vehicle: null,
            boss: null,
            camera: { x: 0, y: 0 },
            score: 0,
            enemiesKilled: 0,
            missionProgress: 0,
            missionLength: 8000,
            keys: {},
            lastShot: 0,
            chargeStartTime: 0,
            isCharging: false,
            time: 0
        };

        // Parallax Background
        class ParallaxLayer {
            constructor(color, speed, yOffset, height, elements) {
                this.color = color;
                this.speed = speed;
                this.yOffset = yOffset;
                this.height = height;
                this.elements = elements || [];
            }

            draw(ctx, cameraX) {
                const offset = cameraX * this.speed;
                
                // Draw base layer
                ctx.fillStyle = this.color;
                ctx.fillRect(0, this.yOffset, canvas.width, this.height);
                
                // Draw elements
                this.elements.forEach(elem => {
                    const x = (elem.x - offset) % (canvas.width * 2);
                    const drawX = x < 0 ? x + canvas.width * 2 : x;
                    
                    if (elem.type === 'mountain') {
                        ctx.fillStyle = elem.color;
                        ctx.beginPath();
                        ctx.moveTo(drawX, this.yOffset + this.height);
                        ctx.lineTo(drawX + elem.width / 2, this.yOffset + this.height - elem.height);
                        ctx.lineTo(drawX + elem.width, this.yOffset + this.height);
                        ctx.fill();
                    } else if (elem.type === 'tree') {
                        // Tree trunk
                        ctx.fillStyle = '#654321';
                        ctx.fillRect(drawX + elem.width / 3, this.yOffset + this.height - elem.height, elem.width / 3, elem.height);
                        // Tree top
                        ctx.fillStyle = elem.color;
                        ctx.beginPath();
                        ctx.arc(drawX + elem.width / 2, this.yOffset + this.height - elem.height, elem.width / 2, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (elem.type === 'rock') {
                        ctx.fillStyle = elem.color;
                        ctx.fillRect(drawX, this.yOffset + this.height - elem.height, elem.width, elem.height);
                    }
                });
            }
        }

        // Create parallax layers
        const parallaxLayers = [
            // Far mountains
            new ParallaxLayer('#4B6B8C', 0.1, 100, 200, [
                { type: 'mountain', x: 200, width: 400, height: 150, color: '#36536B' },
                { type: 'mountain', x: 700, width: 500, height: 180, color: '#36536B' },
                { type: 'mountain', x: 1400, width: 450, height: 160, color: '#36536B' }
            ]),
            // Middle trees
            new ParallaxLayer('#7BA05B', 0.3, 300, 150, [
                { type: 'tree', x: 150, width: 80, height: 100, color: '#4A7C2F' },
                { type: 'tree', x: 450, width: 100, height: 120, color: '#4A7C2F' },
                { type: 'tree', x: 800, width: 90, height: 110, color: '#4A7C2F' },
                { type: 'tree', x: 1200, width: 85, height: 105, color: '#4A7C2F' }
            ]),
            // Near ground
            new ParallaxLayer('#8B7355', 0.5, 450, 270, [
                { type: 'rock', x: 300, width: 60, height: 40, color: '#6B5845' },
                { type: 'rock', x: 700, width: 80, height: 50, color: '#6B5845' },
                { type: 'rock', x: 1100, width: 70, height: 45, color: '#6B5845' }
            ])
        ];

        // Player Class
        class Player {
            constructor(type, x, y) {
                this.type = type;
                const stats = characters[type];
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 50;
                this.vx = 0;
                this.vy = 0;
                this.speed = stats.speed;
                this.jumpPower = stats.jumpPower;
                this.maxHealth = stats.health;
                this.health = stats.health;
                this.fireRate = stats.fireRate;
                this.damage = stats.damage;
                this.special = stats.special;
                this.direction = 1;
                this.grounded = false;
                this.crouching = false;
                this.jumps = 0;
                this.maxJumps = stats.special === 'doubleJump' ? 2 : 1;
                this.inVehicle = false;
                this.vehicle = null;
            }

            update() {
                // Check vehicle interaction
                if (game.vehicle && !this.inVehicle && checkCollision(this, game.vehicle) && game.keys['e']) {
                    this.inVehicle = true;
                    this.vehicle = game.vehicle;
                    game.keys['e'] = false;
                }

                if (this.inVehicle) {
                    // Vehicle controls
                    if (game.keys['a'] || game.keys['ArrowLeft']) {
                        this.vehicle.vx = -this.vehicle.speed;
                        this.direction = -1;
                    } else if (game.keys['d'] || game.keys['ArrowRight']) {
                        this.vehicle.vx = this.vehicle.speed;
                        this.direction = 1;
                    } else {
                        this.vehicle.vx = 0;
                    }

                    this.vehicle.update();
                    this.x = this.vehicle.x + 20;
                    this.y = this.vehicle.y + 10;

                    // Exit vehicle
                    if (game.keys['e']) {
                        this.inVehicle = false;
                        this.x = this.vehicle.x + this.vehicle.width + 20;
                        game.keys['e'] = false;
                    }

                    // Vehicle can shoot
                    if ((game.keys['j'] || game.keys['z']) && Date.now() - game.lastShot > 100) {
                        this.vehicleShoot();
                        game.lastShot = Date.now();
                    }
                } else {
                    // Normal movement
                    if (game.keys['a'] || game.keys['ArrowLeft']) {
                        this.vx = -this.speed;
                        this.direction = -1;
                    } else if (game.keys['d'] || game.keys['ArrowRight']) {
                        this.vx = this.speed;
                        this.direction = 1;
                    } else {
                        this.vx = 0;
                    }

                    // Crouch
                    this.crouching = game.keys['s'] || game.keys['ArrowDown'];

                    // Jump
                    if ((game.keys['w'] || game.keys['ArrowUp'] || game.keys[' ']) && this.jumps < this.maxJumps) {
                        this.vy = -this.jumpPower;
                        this.jumps++;
                        game.keys['w'] = false;
                        game.keys['ArrowUp'] = false;
                        game.keys[' '] = false;
                    }
                }

                // Gravity
                this.vy += 0.8;
                
                // Update position
                this.x += this.vx;
                this.y += this.vy;

                // Ground collision
                const groundY = 450;
                if (this.y >= groundY) {
                    this.y = groundY;
                    this.vy = 0;
                    this.grounded = true;
                    this.jumps = 0;
                } else {
                    this.grounded = false;
                }

                // Keep player in bounds (left side)
                if (this.x < 100) this.x = 100;

                // Camera follows player
                game.camera.x = this.x - 400;
                if (game.camera.x < 0) game.camera.x = 0;

                // Charging laser system
                if (!this.inVehicle) {
                    if (game.keys['j'] || game.keys['z']) {
                        if (!game.isCharging) {
                            game.isCharging = true;
                            game.chargeStartTime = Date.now();
                        }
                    } else if (game.isCharging) {
                        const chargeTime = Date.now() - game.chargeStartTime;
                        if (chargeTime >= 1000) {
                            // Fire charged laser
                            this.shootLaser();
                        } else {
                            // Fire normal shot
                            if (Date.now() - game.lastShot > this.fireRate) {
                                this.shoot();
                                game.lastShot = Date.now();
                            }
                        }
                        game.isCharging = false;
                        game.chargeStartTime = 0;
                    }
                }

                // Grenade
                if (game.keys['k'] || game.keys['x']) {
                    this.throwGrenade();
                    game.keys['k'] = false;
                    game.keys['x'] = false;
                }
            }

            shoot() {
                const bulletY = this.crouching ? this.y + this.height / 2 : this.y + 15;
                const bulletX = this.x + (this.direction > 0 ? this.width : 0);
                
                game.bullets.push({
                    x: bulletX,
                    y: bulletY,
                    width: 8,
                    height: 3,
                    vx: this.direction * 12,
                    damage: this.damage,
                    owner: 'player'
                });

                // Rapid fire special
                if (this.special === 'rapidFire' && Math.random() < 0.3) {
                    setTimeout(() => {
                        game.bullets.push({
                            x: bulletX,
                            y: bulletY - 10,
                            width: 8,
                            height: 3,
                            vx: this.direction * 12,
                            damage: this.damage,
                            owner: 'player'
                        });
                    }, 50);
                }
            }

            shootLaser() {
                const laserY = this.y + 20;
                const laserX = this.x + (this.direction > 0 ? this.width : 0);
                
                game.lasers.push({
                    x: laserX,
                    y: laserY,
                    width: 400,
                    height: 15,
                    direction: this.direction,
                    damage: this.damage * 3,
                    life: 20,
                    owner: 'player'
                });
            }

            vehicleShoot() {
                const bulletY = this.vehicle.y + this.vehicle.height / 2;
                const bulletX = this.vehicle.x + this.vehicle.width;
                
                game.bullets.push({
                    x: bulletX,
                    y: bulletY,
                    width: 12,
                    height: 6,
                    vx: 15,
                    damage: 40,
                    owner: 'player'
                });
            }

            throwGrenade() {
                game.grenades.push({
                    x: this.x + this.width / 2,
                    y: this.y + 10,
                    vx: this.direction * 8,
                    vy: -10,
                    timer: 60,
                    owner: 'player'
                });
            }

            draw(ctx) {
                if (this.inVehicle) return; // Don't draw player when in vehicle
                
                const screenX = this.x - game.camera.x;
                
                // Draw body
                ctx.fillStyle = this.type === 'nova' ? '#4169E1' : 
                               this.type === 'rex' ? '#228B22' : '#FF8C00';
                
                const height = this.crouching ? this.height / 2 : this.height;
                ctx.fillRect(screenX, this.y + (this.crouching ? this.height / 2 : 0), 
                           this.width, height);
                
                // Draw head
                ctx.fillStyle = '#FFE4B5';
                ctx.fillRect(screenX + 10, this.y - 10, 20, 20);
                
                // Draw weapon
                ctx.fillStyle = '#333';
                const weaponY = this.crouching ? this.y + this.height / 2 + 15 : this.y + 20;
                ctx.fillRect(screenX + (this.direction > 0 ? this.width : -20), 
                           weaponY, 20, 5);
                
                // Draw charging indicator
                if (game.isCharging) {
                    const chargeTime = Date.now() - game.chargeStartTime;
                    const chargePercent = Math.min(chargeTime / 1000, 1);
                    ctx.fillStyle = chargePercent >= 1 ? '#00FF00' : '#FFFF00';
                    ctx.fillRect(screenX, this.y - 15, this.width * chargePercent, 3);
                }
                
                // Draw direction indicator
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(screenX + (this.direction > 0 ? this.width - 5 : 0), 
                           this.y + 5, 5, 10);
            }
        }

        // Enemy Class
        class Enemy {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.width = type === 'soldier' ? 35 : type === 'raptor' ? 50 : 60;
                this.height = type === 'soldier' ? 45 : type === 'raptor' ? 40 : 70;
                this.vx = type === 'raptor' ? -4 : -2;
                this.vy = 0;
                this.health = type === 'soldier' ? 30 : type === 'raptor' ? 50 : 80;
                this.damage = type === 'soldier' ? 10 : type === 'raptor' ? 15 : 20;
                this.lastShot = 0;
                this.fireRate = type === 'soldier' ? 1000 : 2000;
                this.points = type === 'soldier' ? 100 : type === 'raptor' ? 200 : 300;
            }

            update() {
                // Move towards player
                this.x += this.vx;

                // Raptor jumps
                if (this.type === 'raptor' && Math.random() < 0.02 && this.y >= 450) {
                    this.vy = -12;
                }

                // Gravity
                this.vy += 0.8;
                this.y += this.vy;

                // Ground
                if (this.y >= 450) {
                    this.y = 450;
                    this.vy = 0;
                }

                // Shoot at player
                if (this.type === 'soldier' && Date.now() - this.lastShot > this.fireRate) {
                    const dist = Math.abs(this.x - game.player.x);
                    if (dist < 500 && dist > 100) {
                        this.shoot();
                        this.lastShot = Date.now();
                    }
                }

                // Remove if too far left
                return this.x > -100;
            }

            shoot() {
                game.bullets.push({
                    x: this.x,
                    y: this.y + this.height / 2,
                    vx: -8,
                    damage: this.damage,
                    owner: 'enemy'
                });
            }

            draw(ctx) {
                const screenX = this.x - game.camera.x;
                
                if (this.type === 'soldier') {
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(screenX, this.y, this.width, this.height);
                    ctx.fillStyle = '#FFE4B5';
                    ctx.fillRect(screenX + 8, this.y - 10, 18, 18);
                } else if (this.type === 'raptor') {
                    // Raptor body
                    ctx.fillStyle = '#556B2F';
                    ctx.fillRect(screenX, this.y + 10, this.width - 10, this.height - 10);
                    // Head
                    ctx.fillRect(screenX - 15, this.y, 20, 20);
                    // Tail
                    ctx.fillRect(screenX + this.width - 15, this.y + 5, 15, 8);
                } else if (this.type === 'trex') {
                    // T-Rex body
                    ctx.fillStyle = '#2F4F2F';
                    ctx.fillRect(screenX, this.y + 20, this.width - 15, this.height - 20);
                    // Head
                    ctx.fillRect(screenX - 20, this.y, 30, 30);
                    // Tail
                    ctx.fillRect(screenX + this.width - 20, this.y + 10, 20, 12);
                }

                // Health bar
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(screenX, this.y - 10, this.width, 5);
                ctx.fillStyle = '#00FF00';
                const healthWidth = (this.health / (this.type === 'soldier' ? 30 : this.type === 'raptor' ? 50 : 80)) * this.width;
                ctx.fillRect(screenX, this.y - 10, healthWidth, 5);
            }
        }

        // Vehicle Class
        class Vehicle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 80;
                this.height = 60;
                this.vx = 0;
                this.speed = 8;
                this.health = 200;
                this.maxHealth = 200;
            }

            update() {
                this.x += this.vx;
            }

            draw(ctx) {
                const screenX = this.x - game.camera.x;
                
                // Tank body
                ctx.fillStyle = '#4A4A4A';
                ctx.fillRect(screenX, this.y + 20, this.width, this.height - 20);
                
                // Turret
                ctx.fillStyle = '#5A5A5A';
                ctx.fillRect(screenX + 20, this.y, 40, 30);
                
                // Cannon
                ctx.fillStyle = '#333';
                ctx.fillRect(screenX + this.width, this.y + 10, 30, 8);
                
                // Tracks
                ctx.fillStyle = '#2A2A2A';
                ctx.fillRect(screenX - 5, this.y + this.height - 15, this.width + 10, 15);
                
                // Health bar
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(screenX, this.y - 10, this.width, 5);
                ctx.fillStyle = '#00FF00';
                const healthWidth = (this.health / this.maxHealth) * this.width;
                ctx.fillRect(screenX, this.y - 10, healthWidth, 5);
                
                // Interaction prompt
                if (game.player && !game.player.inVehicle && checkCollision(game.player, this)) {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '16px Courier New';
                    ctx.fillText('Press E to enter', screenX, this.y - 20);
                }
            }
        }

        // Boss Class
        class Boss {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 150;
                this.height = 180;
                this.vx = 0;
                this.vy = 0;
                this.health = 1000;
                this.maxHealth = 1000;
                this.damage = 25;
                this.lastShot = 0;
                this.fireRate = 500;
                this.phase = 1;
                this.moveTimer = 0;
                this.points = 5000;
            }

            update() {
                this.moveTimer++;
                
                // Boss movement patterns
                if (this.phase === 1) {
                    // Slow approach
                    if (this.x > game.player.x + 600) {
                        this.vx = -1.5;
                    } else {
                        this.vx = 0;
                    }
                } else if (this.phase === 2) {
                    // More aggressive
                    if (this.moveTimer % 120 < 60) {
                        this.vy = Math.sin(this.moveTimer * 0.05) * 2;
                    }
                }

                this.x += this.vx;
                this.y += this.vy;

                // Keep in bounds
                if (this.y < 300) this.y = 300;
                if (this.y > 450) this.y = 450;

                // Shoot patterns
                if (Date.now() - this.lastShot > this.fireRate) {
                    this.shoot();
                    this.lastShot = Date.now();
                }

                // Phase change
                if (this.health < this.maxHealth * 0.5 && this.phase === 1) {
                    this.phase = 2;
                    this.fireRate = 300;
                }

                return this.health > 0;
            }

            shoot() {
                // Multi-shot pattern
                const angles = this.phase === 1 ? [0, -0.2, 0.2] : [0, -0.3, 0.3, -0.15, 0.15];
                
                angles.forEach(angle => {
                    game.bullets.push({
                        x: this.x,
                        y: this.y + this.height / 2,
                        width: 10,
                        height: 10,
                        vx: -10 * Math.cos(angle),
                        vy: 10 * Math.sin(angle),
                        damage: this.damage,
                        owner: 'enemy'
                    });
                });
            }

            draw(ctx) {
                const screenX = this.x - game.camera.x;
                
                // Giant T-Rex boss
                ctx.fillStyle = this.phase === 1 ? '#1A3A1A' : '#8B0000';
                
                // Body
                ctx.fillRect(screenX, this.y + 40, this.width - 30, this.height - 40);
                
                // Head
                ctx.fillRect(screenX - 40, this.y, 60, 60);
                
                // Eyes (glowing)
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(screenX - 35, this.y + 15, 10, 10);
                ctx.fillRect(screenX - 15, this.y + 15, 10, 10);
                
                // Teeth
                ctx.fillStyle = '#FFFFFF';
                for (let i = 0; i < 5; i++) {
                    ctx.fillRect(screenX - 35 + i * 10, this.y + 45, 5, 10);
                }
                
                // Tail
                ctx.fillStyle = this.phase === 1 ? '#1A3A1A' : '#8B0000';
                ctx.fillRect(screenX + this.width - 40, this.y + 20, 40, 20);
                
                // Legs
                ctx.fillRect(screenX + 20, this.y + this.height - 40, 25, 40);
                ctx.fillRect(screenX + 70, this.y + this.height - 40, 25, 40);
                
                // Health bar (large)
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(screenX, this.y - 20, this.width, 10);
                ctx.fillStyle = '#00FF00';
                const healthWidth = (this.health / this.maxHealth) * this.width;
                ctx.fillRect(screenX, this.y - 20, healthWidth, 10);
                
                // Boss name
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 24px Courier New';
                ctx.fillText('MEGA REX', screenX + 10, this.y - 30);
            }
        }

        // Particle Effect
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                game.particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 30,
                    color: color
                });
            }
        }

        // Collision Detection
        function checkCollision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + a.width > b.x &&
                   a.y < b.y + b.height &&
                   a.y + a.height > b.y;
        }

        // Enemy Spawning
        let enemySpawnTimer = 0;
        function spawnEnemies() {
            // Don't spawn during boss fight
            if (game.boss) return;
            
            enemySpawnTimer++;
            
            const spawnX = game.camera.x + canvas.width + 50;
            const difficultyFactor = Math.min(game.missionProgress / 100, 1);
            
            // Soldiers
            if (enemySpawnTimer % 60 === 0 && Math.random() < 0.6 + difficultyFactor * 0.3) {
                game.enemies.push(new Enemy('soldier', spawnX, 450));
            }
            
            // Raptors
            if (enemySpawnTimer % 80 === 0 && Math.random() < 0.4 + difficultyFactor * 0.3) {
                game.enemies.push(new Enemy('raptor', spawnX, 450));
            }
            
            // T-Rex (less frequent, more at higher progress)
            if (enemySpawnTimer % 150 === 0 && Math.random() < 0.2 + difficultyFactor * 0.5) {
                game.enemies.push(new Enemy('trex', spawnX, 450));
            }
        }

        // Update Game
        function update() {
            if (game.state !== 'playing') return;

            game.time++;
            game.player.update();

            // Update enemies
            game.enemies = game.enemies.filter(enemy => {
                const alive = enemy.update();
                if (!alive) return false;

                // Check collision with player
                if (checkCollision(game.player, enemy)) {
                    game.player.health -= enemy.damage * 0.1;
                    createParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, '#FF0000', 5);
                }

                return enemy.health > 0;
            });

            // Update bullets
            game.bullets = game.bullets.filter(bullet => {
                bullet.x += bullet.vx;
                if (bullet.vy) bullet.y += bullet.vy;

                // Check collision
                if (bullet.owner === 'player') {
                    // Check enemies
                    for (let enemy of game.enemies) {
                        if (checkCollision(bullet, enemy)) {
                            let damage = bullet.damage;
                            if (game.player.special === 'heavyDamage') {
                                damage *= 1.5;
                            }
                            enemy.health -= damage;
                            
                            if (enemy.health <= 0) {
                                game.score += enemy.points;
                                game.enemiesKilled++;
                                createParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, '#FFD700', 15);
                            }
                            
                            return false;
                        }
                    }
                    
                    // Check boss
                    if (game.boss && checkCollision(bullet, game.boss)) {
                        game.boss.health -= bullet.damage;
                        createParticles(bullet.x, bullet.y, '#FF6600', 8);
                        
                        if (game.boss.health <= 0) {
                            game.score += game.boss.points;
                            game.enemiesKilled++;
                            createParticles(game.boss.x + game.boss.width / 2, game.boss.y + game.boss.height / 2, '#FFD700', 50);
                            game.boss = null;
                        }
                        
                        return false;
                    }
                } else if (bullet.owner === 'enemy') {
                    // Check player
                    if (!game.player.inVehicle && checkCollision(bullet, game.player)) {
                        game.player.health -= bullet.damage;
                        createParticles(game.player.x + game.player.width / 2, game.player.y + game.player.height / 2, '#FF0000', 8);
                        return false;
                    }
                    
                    // Check vehicle
                    if (game.vehicle && game.player.inVehicle && checkCollision(bullet, game.vehicle)) {
                        game.vehicle.health -= bullet.damage;
                        createParticles(bullet.x, bullet.y, '#FF6600', 5);
                        
                        if (game.vehicle.health <= 0) {
                            game.player.inVehicle = false;
                            game.player.x = game.vehicle.x + 50;
                            game.vehicle = null;
                            createParticles(game.player.x, game.player.y, '#FF4500', 30);
                        }
                        
                        return false;
                    }
                }

                return bullet.x > -50 && bullet.x < game.camera.x + canvas.width + 50;
            });

            // Update lasers
            game.lasers = game.lasers.filter(laser => {
                laser.life--;
                
                // Check all enemies hit by laser
                game.enemies.forEach(enemy => {
                    const laserBox = {
                        x: laser.x,
                        y: laser.y - laser.height / 2,
                        width: laser.width * laser.direction,
                        height: laser.height
                    };
                    
                    if (checkCollision(laserBox, enemy) && !enemy.hitByLaser) {
                        enemy.hitByLaser = true;
                        enemy.health -= laser.damage;
                        createParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, '#00FFFF', 10);
                        
                        if (enemy.health <= 0) {
                            game.score += enemy.points;
                            game.enemiesKilled++;
                        }
                    }
                });
                
                // Check boss
                if (game.boss) {
                    const laserBox = {
                        x: laser.x,
                        y: laser.y - laser.height / 2,
                        width: laser.width * laser.direction,
                        height: laser.height
                    };
                    
                    if (checkCollision(laserBox, game.boss)) {
                        game.boss.health -= laser.damage * 0.1; // Damage per frame
                        if (game.time % 3 === 0) {
                            createParticles(game.boss.x + Math.random() * game.boss.width, game.boss.y + Math.random() * game.boss.height, '#00FFFF', 3);
                        }
                    }
                }
                
                return laser.life > 0;
            });

            // Update grenades
            game.grenades = game.grenades.filter(grenade => {
                grenade.x += grenade.vx;
                grenade.vy += 0.5;
                grenade.y += grenade.vy;
                grenade.timer--;

                if (grenade.y > 450) {
                    grenade.y = 450;
                    grenade.vy = 0;
                    grenade.vx *= 0.7;
                }

                if (grenade.timer <= 0) {
                    // Explosion
                    createParticles(grenade.x, grenade.y, '#FF4500', 25);
                    
                    // Damage enemies in range
                    game.enemies.forEach(enemy => {
                        const dist = Math.hypot(enemy.x - grenade.x, enemy.y - grenade.y);
                        if (dist < 100) {
                            enemy.health -= 50;
                            if (enemy.health <= 0) {
                                game.score += enemy.points;
                                game.enemiesKilled++;
                            }
                        }
                    });
                    
                    return false;
                }

                return true;
            });

            // Update particles
            game.particles = game.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                return p.life > 0;
            });

            // Update vehicle
            if (game.vehicle && !game.player.inVehicle) {
                // Vehicle just sits there waiting
            }

            // Update boss
            if (game.boss) {
                if (!game.boss.update()) {
                    createParticles(game.boss.x + game.boss.width / 2, game.boss.y + game.boss.height / 2, '#FFD700', 100);
                    game.boss = null;
                }
            }

            // Spawn enemies
            spawnEnemies();

            // Update mission progress
            game.missionProgress = Math.min((game.player.x / game.missionLength) * 100, 100);
            
            // Spawn vehicle at 50% progress
            if (game.missionProgress >= 40 && game.missionProgress < 50 && !game.vehicle && !game.vehicleSpawned) {
                game.vehicle = new Vehicle(game.player.x + 300, 450);
                game.vehicleSpawned = true;
            }
            
            // Spawn boss at 95% progress
            if (game.missionProgress >= 95 && !game.boss && !game.bossSpawned) {
                game.boss = new Boss(game.player.x + 800, 380);
                game.bossSpawned = true;
            }

            // Update HUD
            document.getElementById('health').textContent = Math.max(0, Math.floor(game.player.health));
            document.getElementById('score').textContent = game.score;
            document.getElementById('progress').textContent = Math.floor(game.missionProgress);

            // Check game over
            if (game.player.health <= 0) {
                gameOver(false);
            } else if (game.missionProgress >= 100 && !game.boss) {
                gameOver(true);
            }
        }

        // Draw Game
        function draw() {
            // Clear
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw parallax
            parallaxLayers.forEach(layer => layer.draw(ctx, game.camera.x));

            if (game.state === 'playing') {
                // Draw player
                game.player.draw(ctx);

                // Draw vehicle
                if (game.vehicle) {
                    game.vehicle.draw(ctx);
                }

                // Draw enemies
                game.enemies.forEach(enemy => enemy.draw(ctx));
                
                // Draw boss
                if (game.boss) {
                    game.boss.draw(ctx);
                }

                // Draw bullets
                ctx.fillStyle = '#FFD700';
                game.bullets.forEach(bullet => {
                    const screenX = bullet.x - game.camera.x;
                    ctx.fillRect(screenX, bullet.y, bullet.width, bullet.height);
                });
                
                // Draw lasers
                game.lasers.forEach(laser => {
                    const screenX = laser.x - game.camera.x;
                    ctx.fillStyle = '#00FFFF';
                    ctx.globalAlpha = 0.8;
                    ctx.fillRect(screenX, laser.y - laser.height / 2, laser.width * laser.direction, laser.height);
                    
                    // Laser glow effect
                    ctx.fillStyle = '#FFFFFF';
                    ctx.globalAlpha = 0.4;
                    ctx.fillRect(screenX, laser.y - laser.height / 4, laser.width * laser.direction, laser.height / 2);
                    ctx.globalAlpha = 1;
                });

                // Draw grenades
                ctx.fillStyle = '#2F4F4F';
                game.grenades.forEach(grenade => {
                    const screenX = grenade.x - game.camera.x;
                    ctx.beginPath();
                    ctx.arc(screenX, grenade.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                });

                // Draw particles
                game.particles.forEach(p => {
                    const screenX = p.x - game.camera.x;
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.life / 30;
                    ctx.fillRect(screenX, p.y, 4, 4);
                    ctx.globalAlpha = 1;
                });
            }
        }

        // Game Loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Start Game
        function startGame(characterType) {
            game.state = 'playing';
            game.player = new Player(characterType, 200, 450);
            game.enemies = [];
            game.bullets = [];
            game.lasers = [];
            game.grenades = [];
            game.particles = [];
            game.vehicle = null;
            game.boss = null;
            game.vehicleSpawned = false;
            game.bossSpawned = false;
            game.camera = { x: 0, y: 0 };
            game.score = 0;
            game.enemiesKilled = 0;
            game.missionProgress = 0;
            game.lastShot = 0;
            game.chargeStartTime = 0;
            game.isCharging = false;
            game.time = 0;
            enemySpawnTimer = 0;
            
            document.getElementById('hud').style.display = 'block';
        }

        // Game Over
        function gameOver(victory) {
            game.state = 'gameover';
            const gameOverDiv = document.getElementById('gameOver');
            const title = document.getElementById('gameOverTitle');
            
            title.textContent = victory ? 'MISSION COMPLETE!' : 'MISSION FAILED';
            title.style.color = victory ? '#00FF00' : '#FF0000';
            
            document.getElementById('finalScore').textContent = `Final Score: ${game.score}`;
            document.getElementById('enemiesKilled').textContent = `Enemies Defeated: ${game.enemiesKilled}`;
            
            gameOverDiv.classList.remove('hidden');
        }

        // Input Handling
        window.addEventListener('keydown', (e) => {
            game.keys[e.key.toLowerCase()] = true;
        });

        window.addEventListener('keyup', (e) => {
            game.keys[e.key.toLowerCase()] = false;
        });

        // Initialize
        updateLanguage();
        gameLoop();
    </script>
</body>
</html>
